
@{
    ViewBag.Title = "Turning Hệ thống";
    Layout = "~/Views/Shared/_LayoutSuperAdmin.cshtml";
}


<div class="col-md-12 ">
    <div class="portlet light bordered">
        <div class="portlet-title">
            <div class="caption font-red-sunglo">
                <i class="icon-settings font-red-sunglo"></i>
                <span class="caption-subject bold uppercase"> Quản lý cửa hàng</span>
            </div>
        </div>
        <div class="portlet-body form">
            <div>
                <table class="table table-striped table-bordered table-hover">
                    <tbody>
                        <tr>
                            <td style="width:30%;">
                                <div class="form-group">
                                    <select id="serverName" class="form-control">
                                        @{
                                            Dal.Dapper.ModulControl modulControl = new Dal.Dapper.ModulControl();
                                            var modulList = modulControl.AddminGetAllModulType(AEnum.ModulName.Common);
                                            foreach (var item in modulList)
                                            {
                                                <option value="@item.Id">@item.Description</option>
                                            }
                                        }
                                    </select>
                                </div>

                            </td>
                            <td><button type="button" class="btn blue" id="search"><i class="glyphicon glyphicon-plus"></i>Tìm kiếm</button></td>
                        </tr>
                    </tbody>
                </table>
                <table class="table table-striped table-bordered table-hover table-scrollable" id="listCt"></table>
                <div class="form-group">
                    <button class="btn btn-danger" id="archive-RequesAnalytic">Nén bảng RequesAnalytic</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        GetRequet();
        $("#archive-RequesAnalytic").click(function () {
            $.ajax({
                type: "post",
                data: { connectionId: $("#serverName").val() },
                url: "/store/TurningRequesAnalyticTable",
                success: function (data) {        
                    GetRequet();
                }
            });
        });
    });
    $("#search").click(function () {
        GetRequet();
    });
    function GetRequet() {
        $.ajax({
            type: "post",
            data: { connectionId: $("#serverName").val()},
            url: "/store/GetTurningTable",            
            success: function (data) {
                if (data.length > 0) {
                    var html = "<tr><th>Tên bảng cần turning</th><th>Số cột hiện tại</th></tr>";
                    for (var i = 0; i < data.length; i++) {
                        var item = data[i];
                        html += "<tr>";
                        html += "<td>" + item.TableName + "</td>";
                        html += "<td>" + item.RowCounts + "</td>";
                        html += "</tr>";
                    }
                } else {
                    html = "<tr><td colspan='2'>Không có dữ liệu</td></tr>";
                }
                $("#listCt").html(html);
            }
        });
    }
</script>




